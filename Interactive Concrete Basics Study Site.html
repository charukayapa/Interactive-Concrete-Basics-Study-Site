<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Concrete Basics Exam Prep</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom font and scrollbar styling for dark theme */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
        .main-bg {
            background-color: #121212; /* Deep dark background */
        }
        .card-bg {
            background-color: #1e1e1e; /* Slightly lighter card background */
        }
        .text-primary {
            color: #bb86fc; /* Purple/Violet accent */
        }
        .text-secondary {
            color: #03dac6; /* Teal accent */
        }
        .btn-primary {
            background-color: #bb86fc;
            color: #121212;
            transition: all 0.2s;
        }
        .btn-primary:hover {
            background-color: #a46dd6;
        }
        .scroll-container::-webkit-scrollbar {
            width: 8px;
        }
        .scroll-container::-webkit-scrollbar-thumb {
            background-color: #444444;
            border-radius: 4px;
        }
        .scroll-container::-webkit-scrollbar-track {
            background-color: #1e1e1e;
        }
    </style>
</head>
<body class="main-bg text-gray-100 min-h-screen">

    <div id="app" class="flex flex-col md:flex-row min-h-screen">
        <!-- Sidebar Navigation -->
        <nav class="bg-gray-900 md:w-64 p-4 flex md:flex-col justify-between md:justify-start shadow-xl">
            <h1 class="text-2xl font-bold text-primary mb-6 hidden md:block">Concrete Study Hub</h1>
            <div id="nav-links" class="flex md:flex-col space-x-4 md:space-x-0 md:space-y-3 w-full overflow-x-auto">
                <!-- Navigation links will be added here by JavaScript -->
            </div>
            <p class="text-xs text-gray-500 mt-auto pt-4 hidden md:block">Tech 3 Structures 03</p>
        </nav>

        <!-- Main Content Area -->
        <main id="content-area" class="flex-1 p-4 md:p-8 scroll-container overflow-y-auto">
            <!-- Content will be rendered here by JavaScript -->
        </main>
    </div>

    <script>
        // --- 1. DATA STRUCTURES (Based on Lecture Slides) ---

        // NOTE: The user requested 40 MCQs and 20 FITBs. This sample provides 10 MCQs and 5 FITBs.
        // The user can expand the arrays below to meet the full requirement.

        const NOTES_DATA = [
            {
                title: "1. Concrete Components & Mixture",
                content: [
                    "Concrete is composed of three basic components: **Cement** (the binding agent), **Aggregate** (gravel and sand), and **Water**.",
                    "A typical cured concrete batch contains: 10-15% cement, 40-50% gravel, 20-25% sand, and 15-20% water.",
                    "**Additives** are used to improve workability, alter curing times, increase strength, or act as a water repellent.",
                    "A **retarder** is an additive used to slow down the curing time, which is essential in hot weather to prevent weakening of the concrete.",
                    "The final performance is significantly affected by the ratio of components, especially the **Water / Cement Ratio**."
                ],
                keywords: ["Cement", "Aggregate", "Water", "Retarder", "Water/Cement Ratio"]
            },
            {
                title: "2. Curing and Compressive Strength",
                content: [
                    "Fluid concrete normally reaches its designated full design strength at **28 days** after being placed.",
                    "However, over **50%** of strength is achieved within the first 7 days, and approximately **90%** is achieved by 14 days.",
                    "Different elements require different strengths: **17.5 MPa** is common for residential slabs, while **50 MPa** is required for tilt-up precast wall panels.",
                    "The **Water / Cement Ratio** is critical: reducing the volume of water increases the compressive strength.",
                    "Testing: **Test cylinders** are filled from each batch and crushed to assess compressive strength; a **slump test** is used for on-site workability testing."
                ],
                keywords: ["28 days", "14 days", "17.5 MPa", "50 MPa", "Water/Cement Ratio", "Test cylinders", "Slump test"]
            },
            {
                title: "3. Performance and Protection",
                content: [
                    "Due to its density, durability, and non-combustibility, concrete offers excellent performance in three key areas: **Weather-tightness**, **Fire Resistance**, and **Sound Attenuation**.",
                    "Weather-tightness relies on high strength concrete, water repellent admixtures, and good **junction design** (flashings).",
                    "Concrete structures are inherently **fire resistant** compared to steel or timber.",
                    "Fire resistance is linked to thickness (e.g., 140mm thick wall provides approximately 180 minutes of fire resistance).",
                    "For sound, concrete acts as an excellent **party-wall** material; an STC 55 rating is common for a 150 mm concrete wall."
                ],
                keywords: ["Weather-tightness", "Fire Resistance", "Sound Attenuation", "Junction design", "Non-combustible", "Party-wall"]
            },
            {
                title: "4. Reinforcing Steel (Tension vs. Compression)",
                content: [
                    "Cured concrete is strong in **compression** (squashing forces) but weak in **tension** (pulling-apart forces).",
                    "**Reinforcing steel** (rebar) is added specifically to resist these tension forces, as steel is strong in tension.",
                    "Typical types of reinforcing steel include **Deformed bars**, **Plain (round) bars**, and **Welded mesh** (commonly used in floor slabs).",
                    "**Compaction** is a critical site process to remove air voids and ensure the concrete is fully in contact with the steel, which maximizes the structural strength."
                ],
                keywords: ["Compression", "Tension", "Reinforcing steel", "Deformed bars", "Welded mesh", "Compaction", "Air voids"]
            },
            {
                title: "5. Concrete Applications (Insitu, Precast, Masonry)",
                content: [
                    "Structural systems combine **Insitu** (poured on site), **Precast** (factory-made), and **Pre-stressed** concrete.",
                    "**Insitu** is preferred for elements like columns and ground floor slabs because it is easier to achieve rigid **beam/column junctions** and on-site complexity is lower.",
                    "**Precast** is economical and faster for elements like walls, cladding panels, and hollowcore floor panels.",
                    "**Precast tilt panels** are often used for warehouse boundary walls due to their high fire resistance and speed of installation (craned into place and tilted up).",
                    "**Concrete Masonry Blocks** (e.g., 20 Series) must be solid-filled with concrete and reinforcing steel in almost all structural applications."
                ],
                keywords: ["Insitu", "Precast", "Pre-stressed", "Beam/column junctions", "Tilt panels", "Concrete Masonry Blocks"]
            }
        ];

        const MCQ_DATA = [
            // --- Sample MCQs (10 of 40 requested) ---
            {
                q: "What is the primary function of reinforcing steel in a concrete structural element?",
                options: ["To resist compression forces", "To act as the binding agent", "To resist tension forces", "To speed up the curing time"],
                answer: "To resist tension forces",
                explanation: "Cured concrete is strong in compression but very weak in tension (pulling apart). Reinforcing steel, which is strong in tension, is added to counteract these forces."
            },
            {
                q: "What is the typical required strength (MPa) for a residential concrete slab?",
                options: ["50 MPa", "25-35 MPa", "17.5 MPa", "75 MPa"],
                answer: "17.5 MPa",
                explanation: "Residential concrete slabs commonly require 17.5 MPa strength, whereas structural elements like tilt-up panels may require 50 MPa."
            },
            {
                q: "In hot weather, which additive is typically used to slow down the curing time of fluid concrete?",
                options: ["Accelerator", "Retarder", "Water Repellent", "Plasticizer"],
                answer: "Retarder",
                explanation: "A retarder is used to slow curing, as curing too fast in hot conditions can weaken the final concrete strength."
            },
            {
                q: "At what time (in days) does concrete normally reach its designated full design strength?",
                options: ["3 days", "7 days", "14 days", "28 days"],
                answer: "28 days",
                explanation: "While strength develops quickly, the designated full design strength is typically achieved at 28 days."
            },
            {
                q: "Which of the following is NOT one of the three basic components of concrete?",
                options: ["Water", "Cement", "Lime", "Aggregate"],
                answer: "Lime",
                explanation: "The three basic components are Cement (binding agent), Aggregate (gravel and sand), and Water."
            },
            {
                q: "What percentage of concrete's strength is typically achieved within the first seven days?",
                options: ["Less than 15%", "Over 50%", "Exactly 75%", "99%"],
                answer: "Over 50%",
                explanation: "Over 50% of concrete strength is achieved in the first seven days, with approximately 90% reached by 14 days."
            },
            {
                q: "What is the primary factor that increases concrete's compressive strength according to the Water/Cement ratio graph?",
                options: ["Increasing the volume of water", "Reducing the volume of cement", "Reducing the volume of water", "Using a chemical retarder"],
                answer: "Reducing the volume of water",
                explanation: "The graph shows a strong inverse relationship: reducing the Water/Cement ratio (less water) increases the compressive strength."
            },
            {
                q: "Which concrete application is typically preferred as 'insitu' because it is easier to achieve rigid beam/column junctions?",
                options: ["Precast wall panels", "Hollowcore floor panels", "Columns", "Pre-stressed beams"],
                answer: "Columns",
                explanation: "Insitu columns simplify the achievement of rigid connections at beam/column intersections, which is vital for the structural frame."
            },
            {
                q: "Compaction is a critical process to remove what element from fluid concrete?",
                options: ["Excess Water", "Cement dust", "Air voids", "Fine sand"],
                answer: "Air voids",
                explanation: "Compaction removes air voids, ensuring the concrete makes full contact with the reinforcing steel and achieves maximum strength."
            },
            {
                q: "A 140mm thick concrete wall provides approximately how many minutes of fire resistance (based on typical greywacke aggregate)?",
                options: ["60 minutes", "90 minutes", "120 minutes", "180 minutes"],
                answer: "180 minutes",
                explanation: "The lecture slide indicates that 140mm thick concrete provides 180 minutes of fire resistance (NZBC C/AS6)."
            },
            // --- EXPAND HERE: Add 30 more MCQs to reach 40 total. ---
        ];

        const FITB_DATA = [
            // --- Sample Fill-in-the-Blanks (5 of 20 requested) ---
            {
                q: "Concrete's designated design strength is normally reached at _____ days after placement.",
                answer: "28",
                explanation: "The 28-day mark is the standard measurement point for the full design strength of concrete."
            },
            {
                q: "The main binding agent in concrete is _____.",
                answer: "cement",
                explanation: "Cement is the fine powder that chemically reacts with water (hydration) to bind the aggregate together."
            },
            {
                q: "Reinforcing steel is required because concrete is structurally weak in _____ forces.",
                answer: "tension",
                explanation: "Steel resists the pulling-apart (tension) forces, while the concrete mass resists the squashing (compression) forces."
            },
            {
                q: "High strength concrete is an excellent material for sound attenuation, particularly when used as a _____ in apartments.",
                answer: "party-wall",
                explanation: "Due to its high mass and density, concrete greatly reduces sound transmission, making it ideal for shared walls."
            },
            {
                q: "Precast tilt panels are commonly used for warehouse boundary walls due to their high _____ performance.",
                answer: "fire resistance",
                explanation: "Precast tilt panels offer significant density and non-combustibility, providing excellent fire resistance."
            },
            // --- EXPAND HERE: Add 15 more FITBs to reach 20 total. ---
        ];

        const FLASHCARD_DATA = [
            { front: "What is the binding agent in concrete?", back: "Cement" },
            { front: "What strength (MPa) is required for precast tilt-up panels?", back: "50 MPa" },
            { front: "What does reinforcing steel primarily resist?", back: "Tension forces" },
            { front: "What additive slows curing in hot weather?", back: "Retarder" },
            { front: "What day is full design strength normally achieved?", back: "28 days" },
            { front: "What is the critical process to remove air voids?", back: "Compaction" },
            { front: "A 150 mm concrete wall provides what STC rating for sound?", back: "STC 55" },
            { front: "Name one component of aggregate.", back: "Gravel or Sand" },
            { front: "What is the term for concrete poured and cured on site?", back: "Insitu" },
            { front: "What structural junction is easier to achieve with Insitu columns?", back: "Rigid beam/column junctions" }
        ];

        const MINDMAP_NODES = [
            { id: 1, label: "Concrete Basics", x: 50, y: 50, color: "text-primary", size: "text-2xl" },

            { id: 2, label: "Mixture", parent: 1, x: 20, y: 150, color: "text-secondary" },
            { id: 3, label: "Curing & Strength", parent: 1, x: 40, y: 250, color: "text-secondary" },
            { id: 4, label: "Performance", parent: 1, x: 70, y: 350, color: "text-secondary" },
            { id: 5, label: "Reinforcing", parent: 1, x: 100, y: 450, color: "text-secondary" },
            { id: 6, label: "Applications", parent: 1, x: 150, y: 550, color: "text-secondary" },

            // Mixture Sub-nodes
            { id: 21, label: "Cement (Binder)", parent: 2, x: 200, y: 120 },
            { id: 22, label: "Aggregate (Gravel/Sand)", parent: 2, x: 200, y: 160 },
            { id: 23, label: "Additives (Retarder)", parent: 2, x: 200, y: 200 },

            // Curing Sub-nodes
            { id: 31, label: "28 Days (Full Strength)", parent: 3, x: 220, y: 240 },
            { id: 32, label: "90% @ 14 Days", parent: 3, x: 220, y: 280 },
            { id: 33, label: "17.5 MPa (Residential)", parent: 3, x: 220, y: 320 },

            // Performance Sub-nodes
            { id: 41, label: "Fire Resistance", parent: 4, x: 250, y: 360 },
            { id: 42, label: "Sound Attenuation (Party Wall)", parent: 4, x: 250, y: 400 },
            { id: 43, label: "Weather-tightness", parent: 4, x: 250, y: 440 },

            // Reinforcing Sub-nodes
            { id: 51, label: "Strong in Compression", parent: 5, x: 280, y: 480 },
            { id: 52, label: "Weak in Tension (Needs Steel)", parent: 5, x: 280, y: 520 },
            { id: 53, label: "Compaction (Remove Air Voids)", parent: 5, x: 280, y: 560 },

            // Applications Sub-nodes
            { id: 61, label: "Insitu (Columns, Slabs)", parent: 6, x: 320, y: 600 },
            { id: 62, label: "Precast (Walls, Tilt Panels)", parent: 6, x: 320, y: 640 },
            { id: 63, label: "Masonry Blocks (Solid-filled)", parent: 6, x: 320, y: 680 }
        ];

        // --- 2. GLOBAL STATE AND UTILITIES ---

        let appState = {
            currentView: 'notes', // notes, quiz, mindmap, flashcards
            quizMode: 'mcq', // mcq or fitb
            mcqIndex: 0,
            fitbIndex: 0,
            score: 0,
            showExplanation: false,
            flashcardIndex: 0,
            flashcardFlipped: false,
            quizFinished: false,
        };

        const quizDataMap = {
            mcq: { data: MCQ_DATA, current: 'mcqIndex' },
            fitb: { data: FITB_DATA, current: 'fitbIndex' }
        };

        const contentArea = document.getElementById('content-area');
        const navLinks = document.getElementById('nav-links');

        // Utility to escape HTML for safe insertion
        const escapeHTML = str => str.replace(/[&<>"']/g, match => ({
            '&': '&amp;',
            '<': '&lt;',
            '>': '&gt;',
            '"': '&quot;',
            "'": '&#39;'
        }[match]));

        // --- 3. RENDERING FUNCTIONS ---

        function navigate(view, quizMode = null) {
            appState.currentView = view;
            appState.showExplanation = false;
            appState.flashcardFlipped = false;
            appState.flashcardIndex = 0;
            appState.quizFinished = false;

            if (view === 'quiz') {
                appState.quizMode = quizMode || appState.quizMode;
                appState.mcqIndex = 0;
                appState.fitbIndex = 0;
                appState.score = 0;
            }
            renderApp();
        }
        
        // Refactored nav link rendering to dynamically attach listeners
        function renderNavLink(view, label, icon) {
            const isActive = (view === 'mcq_quiz' && appState.currentView === 'quiz' && appState.quizMode === 'mcq') ||
                             (view === 'fitb_quiz' && appState.currentView === 'quiz' && appState.quizMode === 'fitb') ||
                             (view === appState.currentView);

            const classes = isActive
                ? "btn-primary shadow-lg"
                : "text-gray-300 hover:bg-gray-700 hover:text-white";

            // Store navigation intent in data attributes instead of onclick string
            return `
                <button data-view="${view}"
                        data-quiz-mode="${view === 'mcq_quiz' ? 'mcq' : view === 'fitb_quiz' ? 'fitb' : ''}"
                        class="nav-btn p-3 text-sm font-medium rounded-lg text-left w-full transition duration-150 ease-in-out ${classes}">
                    <i class="${icon} mr-3"></i><span class="hidden md:inline">${label}</span><span class="md:hidden">${label.split(' ')[0]}</span>
                </button>
            `;
        }

        // NEW: Function to attach event listeners after rendering
        function setNavigationClickEvent() {
            document.querySelectorAll('.nav-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const view = e.currentTarget.getAttribute('data-view');
                    const quizMode = e.currentTarget.getAttribute('data-quiz-mode');

                    if (view === 'mcq_quiz' || view === 'fitb_quiz') {
                        navigate('quiz', quizMode);
                    } else {
                        navigate(view);
                    }
                });
            });
        }

        function renderNavigation() {
            navLinks.innerHTML = `
                ${renderNavLink('notes', 'Interactive Notes', 'fas fa-book-open')}
                ${renderNavLink('mcq_quiz', '40 MCQ Quiz', 'fas fa-question-circle')}
                ${renderNavLink('fitb_quiz', '20 FITB Quiz', 'fas fa-pen-alt')}
                ${renderNavLink('flashcards', 'Flash Cards', 'fas fa-redo-alt')}
                ${renderNavLink('mindmap', 'Mind Map', 'fas fa-project-diagram')}
            `;
            // Crucial step: attach the correct click handlers
            setNavigationClickEvent();
        }

        function renderNotes() {
            let html = `<h2 class="text-3xl font-extrabold text-primary mb-6 border-b border-gray-700 pb-2">üìö Interactive Lecture Notes: Concrete Basics</h2>`;

            NOTES_DATA.forEach((section, index) => {
                html += `
                    <div class="card-bg p-6 rounded-xl shadow-2xl mb-8 border border-gray-700">
                        <h3 class="text-xl font-semibold text-secondary mb-3">${section.title}</h3>
                        <ul class="list-disc ml-6 space-y-2 text-gray-300">
                            ${section.content.map(p => `<li>${p.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')}</li>`).join('')}
                        </ul>
                        <div class="mt-4 pt-3 border-t border-gray-800">
                            <p class="text-sm font-medium text-gray-500">Keywords: <span class="text-primary">${section.keywords.join(', ')}</span></p>
                        </div>
                    </div>
                `;
            });
            contentArea.innerHTML = html;
        }

        // --- QUIZ FUNCTIONS ---

        function checkAnswer(userAnswer, correct, mode) {
            const currentData = quizDataMap[mode].data;
            const currentIndex = appState[quizDataMap[mode].current];
            const currentItem = currentData[currentIndex];

            // For FITB, normalize input
            if (mode === 'fitb') {
                userAnswer = userAnswer.toLowerCase().trim();
                correct = correct.toLowerCase().trim();
            }

            if (userAnswer === correct) {
                appState.score++;
                alertMessage("Correct!", 'success');
            } else {
                alertMessage("Incorrect.", 'error');
            }

            appState.showExplanation = true;
            renderQuiz();
        }

        function nextQuestion(mode) {
            const currentData = quizDataMap[mode].data;
            const currentIndexKey = quizDataMap[mode].current;
            
            if (appState[currentIndexKey] < currentData.length - 1) {
                appState[currentIndexKey]++;
                appState.showExplanation = false;
                renderQuiz();
            } else {
                appState.quizFinished = true;
                renderQuiz();
            }
        }

        function renderQuiz() {
            const mode = appState.quizMode;
            const currentData = quizDataMap[mode].data;
            const currentIndexKey = quizDataMap[mode].current;
            const currentDataIndex = appState[currentIndexKey];
            const total = currentData.length;

            let html = `
                <h2 class="text-3xl font-extrabold text-primary mb-6 border-b border-gray-700 pb-2">
                    ${mode === 'mcq' ? '‚ùì Multiple Choice Quiz' : 'üìù Fill-in-the-Blanks Quiz'}
                </h2>
                <div class="flex justify-between items-center mb-6 text-lg font-semibold text-gray-400">
                    <p>Question: <span class="text-secondary">${currentDataIndex + 1} / ${total}</span></p>
                    <p>Score: <span class="text-primary">${appState.score}</span></p>
                </div>
            `;

            if (appState.quizFinished) {
                html += `
                    <div class="card-bg p-8 rounded-xl shadow-2xl text-center border border-gray-700">
                        <h3 class="text-2xl font-bold text-secondary mb-4">Quiz Finished!</h3>
                        <p class="text-xl mb-6">Your final score is: <span class="text-primary font-extrabold">${appState.score} / ${total}</span></p>
                        <p class="text-gray-400 mb-6">Great job reviewing the material! You can reset the quiz or try the other mode.</p>
                        <button onclick="navigate('quiz', '${mode}')" class="btn-primary py-2 px-4 rounded-lg font-bold">Restart Quiz</button>
                    </div>
                `;
            } else {
                const item = currentData[currentDataIndex];
                const isMCQ = mode === 'mcq';

                html += `
                    <div class="card-bg p-6 rounded-xl shadow-2xl mb-6 border border-gray-700">
                        <p class="text-xl font-bold mb-4">${item.q}</p>
                        <div class="space-y-3">
                            ${isMCQ ? renderMCQOptions(item) : renderFITBInput(item)}
                        </div>
                    </div>
                `;

                if (appState.showExplanation) {
                    html += `
                        <div class="p-4 rounded-xl shadow-xl mb-6 border border-secondary bg-gray-900">
                            <p class="text-lg font-bold text-secondary mb-2">üí° Explanation:</p>
                            <p class="text-gray-300">${item.explanation}</p>
                            ${isMCQ ? `<p class="mt-2 text-sm text-gray-500">The correct answer was: <span class="text-primary">${item.answer}</span></p>` : ''}
                        </div>
                        <button onclick="nextQuestion('${mode}')" class="btn-primary py-3 px-6 rounded-lg font-bold w-full md:w-auto">
                            Next Question &raquo;
                        </button>
                    `;
                }
            }
            contentArea.innerHTML = html;
        }

        function renderMCQOptions(item) {
            return item.options.map((option, index) => {
                const isCorrect = option === item.answer;
                let colorClass = 'bg-gray-800 hover:bg-gray-700 border-gray-700';

                if (appState.showExplanation) {
                    if (isCorrect) {
                        colorClass = 'bg-green-800 border-green-600'; // Correct
                    } else {
                        colorClass = 'bg-gray-800 border-gray-700 opacity-50'; // Grey out incorrect options
                    }
                }

                return `
                    <button ${appState.showExplanation ? 'disabled' : ''}
                        onclick="checkAnswer('${escapeHTML(option)}', '${escapeHTML(item.answer)}', 'mcq')"
                        class="p-3 w-full text-left rounded-lg border transition duration-150 ${colorClass}">
                        ${option}
                    </button>
                `;
            }).join('');
        }

        function renderFITBInput(item) {
            return `
                <input type="text" id="fitb-input" placeholder="Type your answer here..."
                    class="w-full p-3 rounded-lg bg-gray-800 border border-gray-700 text-gray-100 focus:ring-secondary focus:border-secondary transition duration-150"
                    ${appState.showExplanation ? 'disabled' : ''}>
                <button ${appState.showExplanation ? 'disabled' : ''}
                    onclick="checkFITB('${escapeHTML(item.answer)}')"
                    class="btn-primary py-3 px-6 rounded-lg font-bold w-full">
                    Submit Answer
                </button>
            `;
        }

        function checkFITB(correctAnswer) {
            const inputElement = document.getElementById('fitb-input');
            if (inputElement) {
                const userAnswer = inputElement.value;
                checkAnswer(userAnswer, correctAnswer, 'fitb');
            }
        }

        // --- FLASHCARD FUNCTIONS ---

        function toggleFlashcard() {
            appState.flashcardFlipped = !appState.flashcardFlipped;
            renderFlashcards();
        }

        function nextFlashcard(direction) {
            const total = FLASHCARD_DATA.length;
            if (direction === 1) {
                appState.flashcardIndex = (appState.flashcardIndex + 1) % total;
            } else {
                appState.flashcardIndex = (appState.flashcardIndex - 1 + total) % total;
            }
            appState.flashcardFlipped = false;
            renderFlashcards();
        }

        function renderFlashcards() {
            const card = FLASHCARD_DATA[appState.flashcardIndex];
            const total = FLASHCARD_DATA.length;
            const currentSide = appState.flashcardFlipped ? card.back : card.front;
            const currentLabel = appState.flashcardFlipped ? 'Answer (BACK)' : 'Question (FRONT)';

            contentArea.innerHTML = `
                <h2 class="text-3xl font-extrabold text-primary mb-6 border-b border-gray-700 pb-2">üÉè Flash Cards</h2>
                <div class="text-center mb-6">
                    <p class="text-xl font-semibold text-gray-400">Card: <span class="text-secondary">${appState.flashcardIndex + 1} / ${total}</span></p>
                </div>

                <div onclick="toggleFlashcard()"
                    class="card-bg p-12 h-64 flex flex-col justify-center items-center rounded-xl shadow-2xl mb-8 cursor-pointer transform transition duration-500 hover:shadow-primary/50 border border-gray-700">
                    <p class="text-xl text-gray-500 mb-2">${currentLabel}</p>
                    <p class="text-3xl font-bold text-gray-100 text-center">${currentSide}</p>
                </div>

                <div class="flex justify-between space-x-4 max-w-lg mx-auto">
                    <button onclick="nextFlashcard(-1)" class="btn-primary py-3 px-6 rounded-lg font-bold flex-1">
                        &laquo; Previous
                    </button>
                    <button onclick="toggleFlashcard()" class="btn-primary py-3 px-6 rounded-lg font-bold flex-1">
                        Flip Card
                    </button>
                    <button onclick="nextFlashcard(1)" class="btn-primary py-3 px-6 rounded-lg font-bold flex-1">
                        Next &raquo;
                    </button>
                </div>
            `;
        }

        // --- MIND MAP FUNCTION ---

        function renderMindMap() {
            // A simple, responsive, non-canvas mind map visualization using HTML/CSS
            let html = `
                <h2 class="text-3xl font-extrabold text-primary mb-6 border-b border-gray-700 pb-2">üß† Mind Map Visualization</h2>
                <p class="text-gray-400 mb-8">This map outlines the key concepts and their relationship, visually connecting major topics for guided learning.</p>
                <div id="mindmap-container" class="relative min-h-[700px] w-full mx-auto p-4 md:p-10 card-bg rounded-xl shadow-2xl border border-gray-700">
            `;

            MINDMAP_NODES.forEach(node => {
                const parentNode = node.parent ? MINDMAP_NODES.find(n => n.id === node.parent) : null;
                const top = node.y;
                const left = node.x;

                // Node bubble
                html += `
                    <div id="node-${node.id}" class="absolute p-2 rounded-full shadow-lg text-center transform -translate-x-1/2 -translate-y-1/2 hover:scale-105 transition duration-200 ${node.color || 'bg-gray-700 text-gray-200'} ${node.size || 'text-md'} font-semibold"
                        style="top: ${top}px; left: ${left}%;">
                        ${node.label}
                    </div>
                `;

                // Simplified Connection Line (for visual effect, based on simple top/left percentage positioning)
                if (parentNode) {
                    const lineStyle = `
                        position: absolute;
                        top: ${parentNode.y + 10}px;
                        left: ${parentNode.x + 5}%;
                        height: ${node.y - parentNode.y}px;
                        width: 2px;
                        background-color: #bb86fc;
                        z-index: 0;
                        transform: translateX(-50%);
                    `;

                    // Horizontal offset line (not perfect, but visually suggestive)
                    const offsetStyle = `
                        position: absolute;
                        top: ${node.y}px;
                        left: ${Math.min(parentNode.x, node.x)}%;
                        width: ${Math.abs(parentNode.x - node.x)}%;
                        height: 2px;
                        background-color: #bb86fc;
                        z-index: 0;
                    `;

                    // Since CSS for complex geometry is hard here, we'll draw a simplified vertical line
                    // The line is drawn from the parent's y to the child's y, at the child's x position.
                    const verticalLineStyle = `
                        position: absolute;
                        top: ${parentNode.y + 30}px; /* Start below parent */
                        left: ${node.x}%;
                        height: ${node.y - parentNode.y - 30}px;
                        width: 2px;
                        background-color: #03dac6;
                        transform: translateX(-50%);
                        z-index: 0;
                    `;
                    // html += `<div style="${lineStyle}"></div>`;
                    html += `<div style="${verticalLineStyle}"></div>`;
                }
            });

            html += `</div>`;
            contentArea.innerHTML = html;
        }

        // --- MAIN APP RENDERER ---

        function renderApp() {
            renderNavigation();

            switch (appState.currentView) {
                case 'notes':
                    renderNotes();
                    break;
                case 'quiz':
                    renderQuiz();
                    break;
                case 'flashcards':
                    renderFlashcards();
                    break;
                case 'mindmap':
                    renderMindMap();
                    break;
            }
        }

        // --- MISC / UI UTILITIES ---

        function alertMessage(message, type) {
            const color = type === 'success' ? 'bg-green-700' : 'bg-red-700';
            const html = `
                <div id="alert-box" class="fixed bottom-4 right-4 p-4 rounded-lg shadow-xl text-white font-semibold ${color} z-50 transition-opacity duration-300">
                    ${message}
                </div>
            `;
            const existingAlert = document.getElementById('alert-box');
            if (existingAlert) existingAlert.remove();

            document.body.insertAdjacentHTML('beforeend', html);
            setTimeout(() => {
                const newAlert = document.getElementById('alert-box');
                if (newAlert) newAlert.style.opacity = 0;
                setTimeout(() => {
                    if (newAlert) newAlert.remove();
                }, 300);
            }, 1500);
        }

        // --- INITIALIZATION ---

        // Load Font Awesome for icons
        const fontAwesomeScript = document.createElement('script');
        fontAwesomeScript.src = 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/js/all.min.js';
        fontAwesomeScript.defer = true;
            document.head.appendChild(fontAwesomeScript);

        // Render the initial view
        document.addEventListener('DOMContentLoaded', () => {
            renderApp();
        });
    </script>
</body>
</html>